load("//shared/bazel/rules:cc_rules.bzl", "wpilib_cc_library")
load("//shared/bazel/rules:objectivec_rules.bzl", "wpilib_objc_library")

IMGUI_COMMON_SOURCES = glob(["cpp/*.cpp"]) + [
    "cpp/misc/cpp/imgui_stdlib.cpp",
]

IMGUI_COMMON_HEADERS = glob(["include/*.h"]) + [
    "include/misc/cpp/imgui_stdlib.h",
]

###########################
# Linux
###########################
IMGUI_LINUX_SRCS = [
    "cpp/backends/imgui_impl_glfw.cpp",
    "cpp/backends/imgui_impl_opengl2.cpp",
    "cpp/backends/imgui_impl_opengl3.cpp",
]

IMGUI_LINUX_HDRS = [
    "include/backends/imgui_impl_glfw.h",
    "include/backends/imgui_impl_opengl2.h",
    "include/backends/imgui_impl_opengl3.h",
    "include/backends/imgui_impl_opengl3_loader.h",
]

###########################
# OSX
###########################
IMGUI_DARWIN_SRCS = [
    "cpp/backends/imgui_impl_glfw.cpp",
    "cpp/backends/imgui_impl_metal.mm",
]

IMGUI_DARWIN_HDRS = [
    "include/backends/imgui_impl_glfw.h",
    "include/backends/imgui_impl_metal.h",
]

###########################
# Windows
###########################
IMGUI_WIN_SRCS = [
    "cpp/backends/imgui_impl_glfw.cpp",
    "cpp/backends/imgui_impl_dx11.cpp",
]

IMGUI_WIN_HDRS = [
    "include/backends/imgui_impl_glfw.h",
    "include/backends/imgui_impl_dx11.h",
]

wpilib_cc_library(
    name = "imgui_src",
    srcs = IMGUI_COMMON_SOURCES + select({
        "@bazel_tools//src/conditions:windows": IMGUI_WIN_SRCS,
        "@rules_bzlmodrio_toolchains//constraints/combined:is_linux": IMGUI_LINUX_SRCS,
    }),
    hdrs = IMGUI_COMMON_HEADERS + select({
        "@bazel_tools//src/conditions:windows": IMGUI_WIN_HDRS,
        "@rules_bzlmodrio_toolchains//constraints/combined:is_linux": IMGUI_LINUX_HDRS,
    }),
    includes = [
        "include",
        "include/backends",
        "include/misc/cpp",
    ],
    linkstatic = True,
    strip_include_prefix = "include",
    tags = ["manual"],
    visibility = ["//thirdparty/imgui_suite:__subpackages__"],
    deps = [
        "//thirdparty/imgui_suite/glfw",
    ],
)

wpilib_objc_library(
    name = "imgui_src_darwin",
    srcs = IMGUI_COMMON_SOURCES + IMGUI_DARWIN_SRCS,
    hdrs = IMGUI_COMMON_HEADERS + IMGUI_DARWIN_HDRS,
    include_arc = False,
    includes = [
        "include",
        "include/backends",
        "include/misc/cpp",
    ],
    deps = [
        "//thirdparty/imgui_suite/glfw",
    ],
)

wpilib_cc_library(
    name = "imgui",
    visibility = ["//thirdparty/imgui_suite:__subpackages__"],
    deps = select({
        "@bazel_tools//src/conditions:darwin": [":imgui_src_darwin"],
        "@bazel_tools//src/conditions:windows": [":imgui_src"],
        "@rules_bzlmodrio_toolchains//constraints/combined:is_linux": [":imgui_src"],
    }),
)
